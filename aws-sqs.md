# AWS SQS

## Summary

Notes on using the aws SQS service

## Resources

[IAM Policy Lambda -> SNS](https://stackoverflow.com/questions/32211246/aws-sqs-permissions-for-aws-lambda)

## Use

- helps de-couple/loosely couple the environment
- supports multiple readers/writers in same queue
- single queue can be used by many components (kind of like subscriptions)
- engineered to provide 'at least once' delivery of all messages in queues

## Defaults

- Last In, First Out (LIFO\_) queue
- short polling

## Limitations

- 256KB text limit
- does not Guarantee First In, First Out (FIFO) delivery of messages
- Single request can have from 1 to 10 messages

## Billing

- billed at 64kb chunks
- first 1 million SQS requests per month are free
- \$0.50 per 1 million per month after free amount

## Delivery

SQS never pushes out - apps have to pull

## Timeout of Messages

- 12 hours visibility time out
- delivery timeout clock starts when message is picked up
- Component consuming message deletes it when done

## Does not handle Priority

You should use two separate SQS queues and have your app pull from the
'priority' queue first

## Long Polling

helps reduce costs
eliminates false empty responses
Set ReceiveMessageWaitTime to betweeen 1 and 20 seconds

## Use Cases

- generated by one AWS component to be consumed by another AWS component
- acts as a buffer between producer and consumer of data, good for when one is
  working faster than the other

## Example Flow

- Async pulls task message from queue
- Retrieves named file
- Processes conversion
- Writes image back to S3
- Writes a 'task complete' message to another queue
- Deletes the original task message
- Checks for more messages in the worker queue
